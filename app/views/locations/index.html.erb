<ol class="breadcrumb">
  <li><a href="/trips">My Trips</a></li>
  <li class="active"><%= @trip.name %></li>
</ol>
<%= content_tag :div, class: "locations_information", data: {locations: @locations} do %>
<% end %>
<div class = "trip_name">
<div class = "name_div"><%= @trip.name.capitalize %></div>
</div>
<div id="map"></div>
<!-- add badge for number of messages/invitations -->

<script async defer
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDfDMuS-T8EaT1i_72vzMG181Qm4GyXXos&callback=initMap">
</script>

<script type="text/javascript">
  var map;

  var markers_locations=[];
  var marker_location;
  var addMarker;
  var labels_location = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
  var labelIndex_location = 0;
  var loc_lat;
  var loc_lng;
  var myLatLng_location=[];

  var locations_information = $('.locations_information').data('locations');

  for (var i = 0; i < locations_information.length; i++) {
    var latLng = {lat: parseFloat(locations_information[i].loc_lat), lng: parseFloat(locations_information[i].loc_lng)};
    myLatLng_location.push(latLng);
  };

  function initMap() {

    map = new google.maps.Map(document.getElementById('map'), {
      center: {lat: <%= @trip.lat %>, lng: <%= @trip.lng %>},
      zoom: 15
    });
    // This event listener calls addMarker() when the map is clicked.
    google.maps.event.addListener(map, 'click', function(event) {
      addMarker(event.latLng, map);
    });

  }//initMaps


  function drop() {
    clearMarkers();
    labelIndex_location = 0;
    labels_location = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
    for (var i = 0; i < myLatLng_location.length; i++) {
      addMarkerWithTimeout(myLatLng_location[i], 200+i * 200);
    }
  }

  function addMarkerWithTimeout(position, timeout) {
    window.setTimeout(function() {
      markers_locations.push(new google.maps.Marker({
        position: position,
        label: labels_location[labelIndex_location++ % labels_location.length],
        map: map,
        animation: google.maps.Animation.DROP
      }));
    }, timeout);
  }

  function clearMarkers() {
    for (var i = 0; i < markers_locations.length; i++) {
      markers_locations[i].setMap(null);
    }
    markers_locations = [];
  }

  document.onload = drop();

  function addMarker(location, map) {
    // Add the marker at the clicked location, and add the next-available label
    // from the array of alphabetical characters.
      marker_location = new google.maps.Marker({
        position: location,
        label: labels_location[labelIndex_location++ % labels_location.length],
        map: map
      });
      markers_locations.push(marker_location);
      loc_lat = marker_location.getPosition().lat();
      loc_lng = marker_location.getPosition().lng();
      // debugger
      $('#location_loc_lat').val(loc_lat);
      $('#location_loc_lng').val(loc_lng);
    }//add markers

  // google.maps.event.addDomListener(window, 'load', initMap);

</script>

<div class="location_list">
  <table class="table table-hover">
    <thead>
      <tr>
        <th>Address</th>
        <th>Venue</th>
        <th>Pin Dropper</th>
        <th colspan="3"></th>
      </tr>
    </thead>

    <tbody>
      <% @locations.each do |location| %>
        <tr>
          <td><%= location.address %></td>
          <td><%= location.venue %></td>
          <td><%= location.user.name %></td>
          <td><%= link_to 'Destroy', trip_location_path(@trip,location), method: :delete, data: { confirm: 'Are you sure?' } %></td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>

<div class="location_form">

  <%= form_for :location, url: trip_locations_path(@trip,@locations) do |f| %>
    Loc_lat: <%= f.text_field :loc_lat %> <br>
    Loc_lng: <%= f.text_field :loc_lng %> <br>
    Address: <%= f.text_field :address %> <br>
    Venue: <%= f.text_field :venue %> <br>
    <button type="submit" id="create_trip" class="create_trip">Create</button>
  <% end %>
  <%= link_to 'Back to Trip Plan', trips_path %>
</div>

